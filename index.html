<html>

<head>
  <title>WebP decoding</title>
  <script type="text/javascript">
    const canvas = document.createElement('canvas');
    const offscreen = canvas.transferControlToOffscreen();

    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('sw.js').then(() => {
        return navigator.serviceWorker.ready;
      }).then(() => {
        console.log("sending", offscreen);
        navigator.serviceWorker.controller.postMessage({canvas: offscreen}, [offscreen]);
      })
    }
  </script>
</head>

<body>
  <img src='test2.webp'></img>
</body>
</html>
